// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String     @id @default(cuid())
  email               String     @unique
  password            String
  name                String
  householdSize       Int        @default(2)
  dietaryRestrictions String[]
  favoriteCuisines    String[]
  mealPlans           MealPlan[]
  favoriteRecipes     Recipe[]   @relation("UserFavorites")
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  @@map("users")
}

model Recipe {
  id            String         @id @default(cuid())
  title         String
  description   String?
  cuisine       String
  cookTime      Int            // minutes
  servings      Int
  difficulty    String         // Easy, Medium, Hard
  dietaryTags   String[]       // vegetarian, gluten-free, etc.
  ingredients   Ingredient[]
  instructions  String[]
  imageUrl      String?
  favoritedBy   User[]         @relation("UserFavorites")
  mealPlanItems MealPlanItem[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@map("recipes")
}

model Ingredient {
  id       String @id @default(cuid())
  name     String
  quantity String
  unit     String
  category String // Produce, Dairy, Meat, etc.
  recipeId String
  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@map("ingredients")
}

model MealPlan {
  id            String         @id @default(cuid())
  userId        String
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  weekStartDate DateTime
  meals         MealPlanItem[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@unique([userId, weekStartDate])
  @@map("meal_plans")
}

model MealPlanItem {
  id         String   @id @default(cuid())
  mealPlanId String
  mealPlan   MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  recipeId   String
  recipe     Recipe   @relation(fields: [recipeId], references: [id])
  dayOfWeek  Int      // 0-6 (Sunday-Saturday)
  mealType   String   // breakfast, lunch, dinner
  servings   Int      @default(1)

  @@unique([mealPlanId, dayOfWeek, mealType])
  @@map("meal_plan_items")
}